---
title: "Analysis"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This vignette documents a simple visualisation and tabulation of the data gathered from surveying 21 journals and 300 articles in the field of plant pathology for their openness and reproducibility.

# Set-up Workspace

Load libraries used and setting the ggplot2 theme for the document.

```{r load-libraries}
library("brms")
library("bayestestR")
library("bayesplot")
library("ggplot2")
library("ggpubr")
library("pander")
library("Reproducibility.in.Plant.Pathology")

options(mc.cores = parallel::detectCores())
theme_set(theme_pubclean())
```

## Import Data

Data are imported and the base level is set to Molecular Plant Pathology, the journal with the highest five-year impact factor that will be used as the intercept in the following models.

```{r}
rrpp <- import_notes()
```

## Notes

All models are using the same priors. Because of the amount of zero values in the `reproducibility_score` a `hurdle_gamma()` family is used for all models as well.

### Priors

The priors are fairly flat.

```{r priors}
priors <- prior_string("normal(0, 10)")
```

## Journal Effect Model

Set up a brms model with journal (`abbreviation`) as the fixed effect and `year` and `assignee` as random effects.

```{r journal}
# relevel factors for analyis, use Mol Plant Pathol as basis for analysis, highest IF
rrpp <-
  within(rrpp,
         abbreviation <- relevel(abbreviation, ref = "Mol Plant Pathol"))

m1 <-
  brm(
    formula = reproducibility_score ~  abbreviation + (1 | year) + (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = "hurdle_gamma",
    control = list(adapt_delta = 0.999),
    iter = 3000,
    chains = 4
  )

summary(m1)

plot(m1)

pp_check(m1)

plot(pd(m1))

pander(equivalence_test(m1))
```

## Article Class Model

```{r article-class}
m2 <-
  brm(
    formula = reproducibility_score ~  art_class + (1 | year) + (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = hurdle_gamma(),
    control = list(adapt_delta = 0.9999,
                   max_treedepth = 15),
    iter = 3000,
    chains = 4
  )

summary(m2)

plot(m2)

pp_check(m2)

plot(pd(m2))

pander(equivalence_test(m2))
```

## Five Year Impact Factor Model

```{r IF_5year}
m3 <-
  brm(
    formula = reproducibility_score ~  IF_5year + (1 | year) + (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = hurdle_gamma(),
    control = list(adapt_delta = 0.999),
    iter = 3000,
    chains = 4
  )

summary(m3)

plot(m3)

pp_check(m3)

plot(pd(m3))

pander(equivalence_test(m3))
```


## Molecular Focus Paper Model

```{r molecular}
m4 <-
  brm(
    formula = reproducibility_score ~  molecular + (1 | year) + (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = hurdle_gamma(),
    control = list(adapt_delta = 0.99999),
    iter = 3000,
    chains = 4
  )

summary(m4)

plot(m4)

pp_check(m4)

plot(pd(m4))

pander(equivalence_test(m4))
```

## Journal Open Access Policy Model

```{r open-access}
m5 <-
  brm(
    formula = reproducibility_score ~  open + (1 | year) + (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = hurdle_gamma(),
    control = list(adapt_delta = 0.999),
    iter = 3000,
    chains = 4
  )

summary(m5)

plot(m5)

pp_check(m5)

plot(pd(m5))

pander(equivalence_test(m5))
```

## Year Effect Model

```{r year}
m6 <-
  brm(
    formula = reproducibility_score ~  year + (1 | journal) + (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = "hurdle_gamma",
    control = list(adapt_delta = 0.9999),
    iter = 3000,
    chains = 4
  )

summary(m6)

plot(m6)

pp_check(m6)

plot(pd(m6))

pander(equivalence_test(m6))
```
