---
title: "Analysis"
author: "Adam H Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
```{r setup, include = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This analysis is a simple visualisation and tabulation of the data gathered from surveying 21 journals and 300 articles in the field of plant pathology for their openness and reproducibility.

# Set-up Workspace

Letup workspace by loading libraries used and setting the ggplot2 theme for the document.

```{r load-libraries}
library("dplyr")
library("ggplot2")
library("ggpubr")
library("janitor")
library("magrittr")
library("pander")
library("readODS")
library("Reproducibility.in.Plant.Pathology")
library("tidyr")

theme_set(theme_pubclean())
```

# Import article evaluations

```{r}
rrpp <-
  read_ods(
    system.file("extdata", "article_notes.ods", package = "Reproducibility.in.Plant.Pathology"),
    na = "NA", sheet = 3
  )
```

## Prepare the data

Calculate the reproducibility score, dropping any rows that have `NA` (two) for the full score and convert fields to factors and the tibble to a data.frame.

```{r}
rrpp <-
  rrpp %>%
  mutate(
    reproducibility_score =
      if_else(
        condition = data_avail > 0,
        true = as.integer(comp_mthds_avail) +
          as.integer(software_avail) +
          as.integer(software_cite) +
          as.integer(data_avail),
        false = as.integer(data_avail),
        missing = as.integer(0)
      )
  ) %>%
  mutate(IF_5year =
           if_else(
             condition = is.na(IF_5year),
             true = 0,
             false = IF_5year
           )) %>%
  mutate(art_class = as.factor(art_class)) %>%
  mutate(repro_inst = as.factor(repro_inst)) %>%
  mutate(open = as.factor(open)) %>%
  mutate(abbreviation = as.factor(abbreviation)) %>%
  mutate(assignee = as.factor(assignee)) %>%
  filter(!is.na(reproducibility_score))
```

Create a tidy data frame of the data by unnesting software used as in many cases multiple software packages were used, so will end up with multiple rows for same article, one for each software.

```{r}
rrpp_software <-
  rrpp %>%
  transform(software_used = strsplit(software_used, ",")) %>%
  unnest(software_used) %>% 
  mutate(software_used = trimws(software_used))
```

# Visualise evaluations

## Article classes

What class did the articles fall into, "Applied, 

```{r}
ggplot(rrpp, aes(y = art_class)) +
  geom_bar(stat = "count") +
  xlab("Class(es)") +
  ggtitle("Article Classification")
```

## Computational methods available

Were the computational methods, scripts, source code, _etc._, made available?

```{r}
ggplot(rrpp, aes(y = comp_mthds_avail)) +
  geom_bar() +
  ggtitle("Computational Methods Availability") +
  xlab("Score")
```

## Software availability

Were the software used readily available and preferably open-source?

```{r}
ggplot(rrpp, aes(y = software_avail)) +
  geom_bar() +
  ggtitle("Software Availability") +
  xlab("Score")
```

## Software citations

Were the software that was used properly cited?

```{r}
ggplot(rrpp, aes(y = software_cite)) +
  geom_bar() +
  ggtitle("Software Cited") +
  xlab("Score")
```

## Software used (cited)

Count and sort top 10 software packages cited.
There are likely others that are used, but they have not been properly identified by the authors.

```{r}
tab <- table(rrpp_software$software_used)
tab_s <- sort(tab)
top10 <- tail(names(tab_s), 17) # checking the table, there are several ties
top_software <- subset(rrpp_software, software_used %in% top10)
top_software$software_used <- factor(top_software$software_used,
                                     levels = rev(top10))

ggplot(top_software, aes(y = software_used)) +
  geom_bar() +
  ggtitle("Top 10 Software Used") +
  xlab("Software") +
  ylab("Count")
```

## Data availability

Were the data made readily available?

```{r}
ggplot(rrpp, aes(y = data_avail)) +
  geom_bar() +
  ggtitle("Data Availability") +
  xlab("Score")
```

## Reproducibility score

The reproducibility score was calculated as the sum of the scores for computational method availability, 

```{r}
ggplot(rrpp, aes(y = reproducibility_score)) +
  geom_bar() +
  ggtitle("Combined Reproducibility Score") +
  xlab("Score")
```

## Article class effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = art_class)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.25, alpha = 0.5) +
  ggtitle("Article Class Effect") +
  xlab("Class(es)") +
  ylab("Score")
```

## Journal effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = abbreviation)) +
  geom_count() +
  ggtitle("Journal Effect") +
  xlab("Journal") +
  ylab("Score")
```

## Evaluator effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = assignee)) +
  geom_count() +
  ggtitle("Evaluator Effect") +
  xlab("Evaluator") +
  ylab("Score")
```

## Five year impact factor effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = IF_5year)) +
  geom_count() +
  ggtitle("Five Year IF Effect") +
  xlab("Impact Factor") +
  ylab("Score")
```

## Journal open access effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = open)) +
  geom_count() +
  ggtitle("Open Access Effect") +
  xlab("Open Access Classification") +
  ylab("Score")
```

## Journal reproducibility instructions effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = as.factor(repro_inst))) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.25, alpha = 0.5) +
  ggtitle("Reproducibility Instructions Effect") +
  xlab("Reproducibility Instructions Score") +
  ylab("Score")
```

## Tables

### Table of Journals Surveyed

```{r journals}
rrpp_journals <- tabyl(rrpp, journal)[, -3]
names(rrpp_journals) <- c("Journal", "n")
pander(rrpp_journals)
```

### Table of Article Scores

```{r table_scores}
article_scores <- tabyl(rrpp, reproducibility_score)
names(article_scores) <- c("Score", "n", "Percent")
article_scores$Percent <- round(article_scores$Percent * 100, 1)
pander(article_scores)
```

