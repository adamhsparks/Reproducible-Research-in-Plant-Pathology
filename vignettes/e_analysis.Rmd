---
title: "Analysis"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
```{r setup, include = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This analysis is a simple visualisation and tabulation of the data gathered from surveying 21 journals and 300 articles in the field of plant pathology for their openness and reproducibility.

# Set-up Workspace

Load libraries used and setting the ggplot2 theme for the document.

```{r load-libraries}
library("tidyverse")
library("ggpubr")
library("janitor")
library("pander")
library("Reproducibility.in.Plant.Pathology")

theme_set(theme_pubclean())
```

## Import the data and calculate the reproducibility score

```{r}
rrpp <- import_notes()
```

Create a tidy data frame of the data by unnesting software used as in many cases multiple software packages were used, so will end up with multiple rows for same article, one for each software.

```{r}
rrpp_software <-
  rrpp %>%
  transform(software_used = strsplit(software_used, ",")) %>%
  unnest(software_used) %>% 
  mutate(software_used = trimws(software_used)) %>% 
  mutate(software_used = toupper(software_used)) # convert all to uppercase to standardise
```

# Visualise evaluations

## Article classes

What class did the articles fall into, "Applied, 

```{r}
ggplot(rrpp, aes(y = art_class)) +
  geom_bar() +
  ylab("Class") +
  ggtitle("Article Classification")
```

## Computational methods available

Were the computational methods, scripts, source code, _etc._, made available?

```{r}
ggplot(rrpp, aes(y = comp_mthds_avail)) +
  geom_bar() +
  ggtitle("Computational Methods Availability") +
  ylab("Score")
```

## Software availability

Were the software used readily available and preferably open-source?

```{r}
ggplot(rrpp, aes(y = software_avail)) +
  geom_bar() +
  ggtitle("Software Availability") +
  ylab("Score")
```

## Software citations

Were the software that was used properly cited?

```{r}
ggplot(rrpp, aes(y = software_cite)) +
  geom_bar() +
  ggtitle("Software Cited") +
  ylab("Score")
```

## Software used (cited)

Count and sort top 10 software packages cited.
There are likely others that are used, but they have not been properly cited or listed by the authors.

```{r}
tab <- table(rrpp_software$software_used)
tab_s <- sort(tab)
top10 <- tail(names(tab_s), 14) # checking the table, there are several ties
top_software <- subset(rrpp_software, software_used %in% top10)
top_software$software_used <- factor(top_software$software_used,
                                     levels = rev(top10))

ggplot(top_software, aes(y = software_used)) +
  geom_bar() +
  ggtitle("Top 10 Software Used") +
  xlab("Count") +
  ylab("Software")
```

## Data availability

Were the data made readily available?

```{r}
ggplot(rrpp, aes(y = data_avail)) +
  geom_bar() +
  ggtitle("Data Availability") +
  ylab("Score")
```

## Reproducibility score

The reproducibility score was calculated as the sum of the scores for computational method availability, 

```{r}
ggplot(rrpp, aes(y = reproducibility_score)) +
  geom_bar() +
  ggtitle("Combined Reproducibility Score") +
  ylab("Score")
```

## Article class effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = art_class)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.25, alpha = 0.5) +
  ggtitle("Article Class Effect") +
  ylab("Class") +
  xlab("Score")

wilcox.test(reproducibility_score ~ art_class, data = rrpp)
```

The Mann-Whitney U test indicates that the article class does not affect the assigned reproducibility score.

## Journal effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = abbreviation)) +
  geom_count() +
  ggtitle("Journal Effect") +
  ylab("Journal") +
  xlab("Score")

kruskal.test(reproducibility_score ~ as.factor(abbreviation), data = rrpp)
```

The Kruskal-Wallis test indicates that the journal title does not appear to have an effect on the assigned reproducibility score.

## Evaluator effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = assignee)) +
  geom_count() +
  ggtitle("Evaluator Effect") +
  ylab("Evaluator") +
  xlab("Score")

kruskal.test(reproducibility_score ~ assignee, data = rrpp)
```

The Kruskal-Wallis test indicates that the assigned reviewer does not have an effect on the reproducibility scores assigned.

## Five year impact factor effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = IF_5year)) +
  geom_count() +
  ggtitle("Five Year IF Effect") +
  ylab("Impact Factor") +
  xlab("Score")

kruskal.test(reproducibility_score ~ IF_5year, data = rrpp)
```

The Mann-Whitney U Test suggests that impact factor does not appear to have an effect on the reproducibility score.

## Journal open access effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = open)) +
  geom_count() +
  ggtitle("Open Access Effect") +
  ylab("Open Access Classification") +
  xlab("Score")

wilcox.test(reproducibility_score ~ open, data = rrpp)
```

The Mannâ€“Whitney U test indicates that the journal's open access status does not affect the reproducibility score.

## Journal reproducibility instructions effect on reproducibility score

```{r}
ggplot(rrpp, aes(x = reproducibility_score,
                 y = as.factor(repro_inst))) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.25, alpha = 0.5) +
  ggtitle("Reproducibility Instructions Effect") +
  ylab("Reproducibility Instructions Score") +
  xlab("Score")

kruskal.test(reproducibility_score ~ as.factor(repro_inst), data = rrpp)
```

The Kruskal-Wallis test indicates that the journals' instructions for authors concerning sharing data and reproducibility have no effect on the score assigned.

## Tables

### Table of Journals Surveyed

```{r journals}
rrpp_journals <- tabyl(rrpp, journal)[, -3]
names(rrpp_journals) <- c("Journal", "n")
pander(rrpp_journals)
```

### Table of Article Scores

```{r table_scores}
article_scores <- tabyl(rrpp, reproducibility_score)
names(article_scores) <- c("Score", "n", "Percent")
article_scores$Percent <- round(article_scores$Percent * 100, 1)
pander(article_scores)
```

